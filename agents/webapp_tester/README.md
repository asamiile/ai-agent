## Webアプリケーションテストエージェント (`agents/webapp_tester`)

このディレクトリには、Webアプリケーションの自動テストを生成・実行するためのエージェントが格納されています。指定されたURLをクロールし、そのページのコンテンツに基づいてPlaywright + pytest形式のエンドツーエンド（E2E）テストコードをAIが自動生成し、実行、そして詳細なレポートを出力します。

### 機能詳細と目的

`webapp_tester` エージェントの主な目的は、QAエンジニアの作業を自動化し、Webアプリケーションの品質保証プロセスを加速することです。以下の主要な機能を提供します。

1.  **Webページコンテンツの取得**: Playwrightを使用してターゲットとなるWebページのHTML構造やテキストコンテンツ、リンクを動的に取得します。
2.  **AIによるテスト計画の立案**: Google Gemini APIを利用し、取得したページコンテンツを分析して、網羅的なテストシナリオ（テスト計画）をMarkdown形式で自動的に考案します。各テストケースには、目的、手順、期待される結果が記述されます。
3.  **AIによるテストコードの生成**: 作成されたテスト計画に基づき、Playwright (Python sync_api) と pytest を用いた実用的なテストコードをPythonファイルとして生成します。この際、厳密な判定の回避、ロケータの優先順位、スクリーンショットの保存方法など、堅牢なテストコードを生成するための詳細な制約がプロンプトで与えられています。
4.  **テストの自動実行**: 生成されたPlaywrightテストコードを `pytest` コマンドで実行します。テストのタイムアウト処理も含まれています。
5.  **詳細なテストレポートの生成**: テストの実行結果（成功/失敗、標準出力、エラー出力）と、実行中に自動的に取得されたスクリーンショットをまとめたMarkdown形式のレポートを生成します。これにより、テスト結果の視覚的な確認とデバッグが容易になります。
6.  **複数ページのクロールとテスト**: 開始URLから主要な内部リンクを最大6ページまでクロールし、各ページに対してテスト生成・実行・レポート作成の一連のワークフローを自動的に実行します。

### 実行方法

このエージェントは、プロジェクトのルートディレクトリから以下のコマンドで実行できます。テストしたいWebアプリケーションのURLを引数として指定してください。

bash
python agents/webapp_tester/main.py <ターゲットURL>


**例:**

bash
python agents/webapp_tester/main.py https://asami.tokyo/


**事前準備:**
Google Gemini APIを使用するため、環境変数 `GOOGLE_AI_STUDIO_API_KEY` にAPIキーを設定する必要があります。

bash
export GOOGLE_AI_STUDIO_API_KEY="YOUR_GEMINI_API_KEY"


### 依存している共通モジュール (`common/`) への言及

この `webapp_tester` エージェントは、`common/` ディレクトリ内のモジュールを**直接**インポートして使用していません。しかし、`requirements.txt` に記載されている `playwright` ライブラリを中核としており、これは `common/scrapers/` ディレクトリ内の他のスクレイピングモジュール（例: `yahoo.py`, `zozo.py`）でも利用されている共通のブラウザ自動化技術です。

このプロジェクト全体でWeb操作が必要なタスクにPlaywrightが共通基盤として採用されており、`webapp_tester` もその恩恵を受けています。

### ファイル構成の解説

-   **`main.py`**:
    -   このエージェントのメインエントリーポイントです。
    -   Webページのコンテンツ取得、AIへのテスト計画とコード生成の指示、生成されたテストの実行、そして結果レポートの作成といった一連のワークフローを制御します。
    -   複数ページのクロールとテスト実行のロジックも含まれています。

-   **`prompts.py`**:
    -   Google Gemini APIに渡すためのプロンプト定義を格納しています。
    -   `PLANNING_PROMPT`: Webページのコンテンツからテスト計画を立案するためのプロンプト。
    -   `CODING_PROMPT`: 立案されたテスト計画に基づいて、Playwright + pytest形式のテストコードを生成するためのプロンプト。AIがテストコードの品質と堅牢性を保つための具体的な指示（セレクタの優先順位、アサーションのベストプラクティス、スクリーンショットの保存方法など）が詳細に記述されています。

-   **`__init__.py`**:
    -   このディレクトリがPythonのパッケージであることを示すための空のファイルです。

-   **`test_comparison.md`, `IMPROVEMENT_SUMMARY.md` (生成物)**:
    -   これらはエージェント自身が過去にテストを実行し、その改善過程を記録したレポートです。
    -   `test_comparison.md` は異なる実行結果を比較し、エージェントの性能向上点と残存する課題を分析しています。
    -   `IMPROVEMENT_SUMMARY.md` は、エージェントの最新の改善内容と最終的な成果をまとめたものです。
    -   これらのファイルは、`webapp_tester` エージェントの自己改善能力と、生成されるレポートの品質を示す具体的な例として機能します。