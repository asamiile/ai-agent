## webapp_tester

### 概要
`agents/webapp_tester/`ディレクトリは、AIを活用してWebアプリケーションの自動テストを行うエージェントを格納しています。このエージェントは、指定されたWebサイトのコンテンツを分析し、Playwrightとpytestを用いたテストシナリオとテストコードを自動生成します。生成されたテストは実行され、失敗した場合はAIによる自動修正が試みられます。最終的に、テスト結果は詳細なレポートとして出力され、Webアプリケーションの品質保証プロセスを効率化します。

主な機能は以下の通りです。
- Webページのコンテンツ（テキスト、リンク）の取得。
- AI（Google Gemini）による網羅的なテストシナリオの考案。
- 考案されたシナリオに基づくPlaywright + pytestテストコードの自動生成。
- 生成されたテストコードの実行と結果の取得。
- テスト失敗時のAIによるテストコードの自動修正（リトライ機能）。
- 各テスト実行の詳細なMarkdownレポートとスクリーンショットの生成。
- クローリングによる複数ページのテスト実行とサマリーレポートの生成。

### ディレクトリ構成


agents/webapp_tester/
├── prompts.py
├── main.py
└── outputs/
    └── {timestamp}_{domain_name}/
        ├── test_{domain_slug}.py
        ├── report_{domain_slug}.md
        ├── summary.md
        └── *.png


### 各ファイル/モジュールの説明

| ファイル/モジュール名   | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ART-TC-004: ツール情報が正確に表示されることを確認する。
- **目的**: 「Art」ページに表示されているツール情報が正確であるか検証します。
- **手順**:
    1. `https://asami.tokyo/art` にアクセスします。
- **期待される結果**:
    1. 「Tools: TouchDesigner, Photoshop, Midjourney, Runway」というテキストが正確に表示されること。

### 実行方法

このエージェントは、Pythonの実行コマンドに続けてテストしたいWebページのURLを引数として渡すことで実行できます。

1. **リポジトリのクローンと初期設定**:
   まず、リポジトリをクローンし、依存関係をインストールします。

   bash
   git clone https://github.com/your-repo/your-project.git
   cd your-project
   pip install -r requirements.txt
   playwright install  # Playwrightが利用するブラウザバイナリをインストール
   

2. **環境変数の設定**:
   `.env.example`ファイルを参考に、`.env`ファイルを作成し、`GOOGLE_AI_STUDIO_API_KEY`を設定します。

   bash
   cp .env.example .env
   # .env ファイルを開き、GOOGLE_AI_STUDIO_API_KEY をご自身のAPIキーに置き換えてください。
   # GOOGLE_AI_STUDIO_API_KEY="your_google_gemini_api_key_here"
   # DISCORD_WEBHOOK_URL="your_discord_webhook_url_here" # 必要であれば設定
   

3. **エージェントの実行**:
   `agents/webapp_tester/main.py`スクリプトを実行し、テストしたいWebページのURLを引数として渡します。

   bash
   python agents/webapp_tester/main.py https://asami.tokyo
   
   
   実行後、`outputs/`ディレクトリ内にタイムスタンプとドメイン名に基づいた新しいサブディレクトリが作成され、生成されたテストコード、実行ログ、スクリーンショット、そしてMarkdown形式のレポートが保存されます。

### 環境変数

| 環境変数名             | 説明                                                                     | 必須/任意 |
|----------------------|--------------------------------------------------------------------------|-----------|
| `GOOGLE_AI_STUDIO_API_KEY` | Google Gemini APIにアクセスするためのAPIキー。                            | 必須      |
| `DISCORD_WEBHOOK_URL`    | Discordに通知を送信するためのWebhook URL。このエージェントでは直接使用されませんが、`common/discord.py`が利用するため、他のエージェントで通知機能を使う場合に設定が必要となる場合があります。 | 任意      |