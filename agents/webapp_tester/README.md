# agents/webapp_tester

## 概要
`webapp_tester` ディレクトリは、AI (Google Gemini) を活用してWebサイトの自動テストを生成、実行、そして必要に応じて修正するエージェントです。指定されたURLのWebページコンテンツを分析し、Playwrightとpytestを用いた包括的なテストスイートを自動で作成・実行することで、Webアプリケーションの品質保証プロセスを効率化します。テストが失敗した場合は、AIがエラーログを分析し、テストコードを自己修正する機能も備えています。

## ディレクトリ構成

agents/webapp_tester/
├── main.py
└── prompts.py


## 各ファイル/モジュールの説明

| ファイル名      | 概要                                                                                                                                                                                                                                                                   |
| :-------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `main.py`       | このエージェントのメインロジックが含まれるファイルです。指定されたURLからWebページコンテンツを取得し、AIにテスト計画とPlaywrightテストコードを生成させ、それらのテストを実行します。テストが失敗した際には、AIによるコード修正（ヒーリング）も試み、テストの再実行を行います。 |
| `prompts.py`    | AI (Google Gemini) に与えるプロンプト定義を保持するファイルです。テスト計画作成 (`PLANNING_PROMPT`)、テストコード生成 (`CODING_PROMPT`)、失敗したテストコード修正 (`FIXING_PROMPT`) のためのプロンプトが含まれています。                                                               |

## 実行方法
このエージェントは、コマンドライン引数としてテスト対象のURLを受け取り、テストプロセスを開始します。

1.  **依存ライブラリのインストール**:
    プロジェクトルートの `requirements.txt` に記載されているライブラリをインストールします。
    bash
    pip install -r requirements.txt
    playwright install
    

2.  **実行コマンド**:
    `main.py` を直接実行し、引数にテスト対象のURLを指定します。

    bash
    python agents/webapp_tester/main.py https://example.com
    
    実行例:
    bash
    python agents/webapp_tester/main.py https://www.google.com
    

    これにより、指定されたURLに対して以下のプロセスが実行されます:
    -   Webページのコンテンツ取得
    -   AIによるテストシナリオの考案
    -   AIによるPlaywrightテストコードの生成
    -   生成されたテストコードの実行
    -   テスト結果の表示（失敗時はAIによるコード修正試行）
    -   生成されたテストコードとスクリーンショットは `tests/generated/{timestamp}_{domain}/` ディレクトリに保存されます。

## 環境変数
このエージェントの実行には、以下の環境変数の設定が必要です。`.env` ファイルに設定するか、環境変数として直接設定してください。

| 環境変数                  | 説明                                     |
| :------------------------ | :--------------------------------------- |
| `GOOGLE_AI_STUDIO_API_KEY` | Google Generative AI (Gemini) API にアクセスするためのAPIキー。 |

`.env.example` を参考に、プロジェクトルートに `.env` ファイルを作成してください。

ini
# .env の例
GOOGLE_AI_STUDIO_API_KEY="YOUR_GOOGLE_AI_STUDIO_API_KEY"