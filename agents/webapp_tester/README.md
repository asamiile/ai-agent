# `agents/webapp_tester/`

## 概要

`agents/webapp_tester/` ディレクトリは、Gemini AI と Playwright を活用してWebアプリケーションのテストプロセスを自動化するためのエージェントを格納しています。このエージェントは、指定されたWebページのURLとコンテンツを分析し、網羅的なテストシナリオを考案します。その後、そのシナリオに基づいて実際に動作する Playwright + Pytest のテストコードを自動生成します。

生成されたテストコードは実行され、その結果は詳細なMarkdownレポートとして出力されます。さらに、テストが失敗した場合には、エラーログに基づいてAIがテストコードの修正を試みる「自己修復」機能も備えています。

## ディレクトリ構成


agents/
└── webapp_tester/
    ├── main.py
    ├── prompts.py
    └── outputs/
        └── {timestamp}_{domain}/
            ├── test_{domain}.py
            ├── report_{domain}.md
            └── summary.md


## 各ファイル/モジュールの説明

| ファイル/フォルダ名         | 説明                                                                                                                                                                                                                                                                                                                                                                |
| :-------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `main.py`                   | このエージェントの主要な実行ロジックが含まれます。以下の機能を担当します。<br>- ページのコンテンツ取得 (Playwright)<br>- テスト計画とテストコードの生成 (Gemini AI)<br>- 生成されたテストコードのファイル保存<br>- `pytest` を用いたテストコードの実行<br>- テスト失敗時のコード修正 (Gemini AI)<br>- テスト結果のレポート生成<br>- クローリングによる複数ページのテスト実行 |
| `prompts.py`                | Gemini AI にテスト計画の立案、テストコードの生成、テストコードの修正を指示するためのプロンプト定義です。<br>- `PLANNING_PROMPT`: WebページのURLとコンテンツからテストシナリオを生成するプロンプト。<br>- `CODING_PROMPT`: テストシナリオに基づき、Playwright + Pytestのテストコードを生成するプロンプト。<br>- `FIXING_PROMPT`: 失敗したテストコードとエラーログから、修正版のコードを生成するプロンプト。 |
| `outputs/`                  | `main.py` の実行によって動的に生成されるテストコード（`test_*.py`）とテストレポート（`report_*.md`, `summary.md`）が保存されるディレクトリです。実行ごとにタイムスタンプとターゲットドメインに基づくサブディレクトリが作成されます。                                                                                                                                                           |
| `common/discord.py`         | (プロジェクトルートの `common/` ディレクトリ配下) Discord通知機能。本エージェントでは直接利用されていませんが、他のエージェントがテスト結果の通知に利用する可能性があります。                                                                                                                                                                                          |
| `common/scrapers/yahoo.py`  | (プロジェクトルートの `common/` ディレクトリ配下) Yahoo!ショッピングのスクレイピング機能。本エージェントでは直接利用されていませんが、Playwrightを利用する共通機能として存在します。                                                                                                                                                                                      |
| `common/scrapers/zozo.py`   | (プロジェクトルートの `common/` ディレクトリ配下) ZOZOのスクレイピング機能。本エージェントでは直接利用されていませんが、Playwrightを利用する共通機能として存在します。                                                                                                                                                                                                      |

## 実行方法

任意のWebサイトのURLを指定してテストを実行します。

bash
python agents/webapp_tester/main.py <TARGET_URL>


**例:**

bash
python agents/webapp_tester/main.py https://example.com


実行が完了すると、`outputs/` ディレクトリ配下にタイムスタンプとドメイン名に基づいた新しいディレクトリが作成され、その中に生成されたテストコード、実行ログ、およびMarkdown形式のレポートが保存されます。

## 環境変数

このエージェントの実行には以下の環境変数の設定が必要です。

`.env` ファイルに設定を記述してください。

| 環境変数名                | 説明                                         | 必須/任意 |
| :------------------------ | :------------------------------------------- | :-------- |
| `GOOGLE_AI_STUDIO_API_KEY` | Gemini API にアクセスするための API キーです。 | 必須      |