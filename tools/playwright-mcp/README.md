# Playwright を活用した Web アプリ探索テスト

## クイックスタート

以下のプロンプトでテストを開始できます：

```
tools/playwright-mcp/README.md を読み込んで [URL] のテストを開始してください
```

### AIエージェントへの指示

このREADMEを読み込んだAIエージェントは、以下のテストを自動的に実行してください：

1. **基本テスト**（必須）
   - 対象URLにアクセス
   - 全ページのナビゲーション確認
   - フォームがあれば入力テスト
   - コンソールエラーの確認

2. **発展テスト**（推奨）
   - 404ページの確認（存在しないURLにアクセス）
   - フォームバリデーション（空送信、不正入力）
   - レスポンシブテスト（320x568, 768x1024, 1440x900）
   - インタラクティブ要素（カルーセル、ホバー等）

3. **レポート作成**
   - `tools/playwright-mcp/reports/YYYYMMDD_サイト名/` にREADME.mdを作成
   - スクリーンショットを `screenshots/` に保存
   - 問題があれば「修正が必要な箇所」セクションに記載

---

## 概要

Playwright MCP (Model Context Protocol) を使用して、AIエージェントがWebアプリケーションを探索的にテストする手順をまとめたドキュメントです。

## 前提条件

- VS Code with GitHub Copilot
- Playwright MCP Server が有効化されていること

## 探索テストの手順

### 1. ブラウザでサイトにアクセス

```
Playwrightツールを使って、[対象URL]にアクセスしてください。
```

AI エージェントは `browser_navigate` ツールを使用してサイトにアクセスします。

### 2. ページ構造の確認

アクセス後、自動的にページのスナップショットが取得され、以下の情報が確認できます：

- ページ URL
- ページタイトル
- DOM 構造（アクセシブルな要素のツリー）
- ナビゲーション要素
- リンク、ボタン、フォーム要素

### 3. ナビゲーションテスト

各ページへのリンクをクリックして遷移をテストします：

```
各ナビゲーションリンクをクリックして、ページ遷移をテストしてください。
```

**確認項目：**
- リンクが正常に動作するか
- 遷移先のページが正しく表示されるか
- ページタイトルが適切か

### 4. フォームテスト

フォームがある場合は入力テストを実施：

```
フォームに値を入力して、動作を確認してください。
```

**確認項目：**
- テキスト入力が正常にできるか
- ドロップダウン選択が動作するか
- バリデーションが機能するか
- 送信ボタンが動作するか

### 5. インタラクティブ要素のテスト

カルーセル、タブ、モーダルなどの動的要素をテスト：

```
ページ内のインタラクティブな要素（カルーセル、タブなど）をテストしてください。
```

### 6. レスポンシブデザインテスト

画面サイズを変更してレスポンシブ対応を確認：

```
モバイルサイズ（375x812）でレスポンシブデザインをテストしてください。
```

**一般的なビューポートサイズ：**
| デバイス | 幅 | 高さ |
|----------|-----|------|
| iPhone SE | 375 | 667 |
| iPhone 12/13 | 390 | 844 |
| iPad | 768 | 1024 |
| Desktop | 1280 | 720 |

### 7. コンソールエラーの確認

JavaScript エラーがないか確認：

```
コンソールにエラーが出ていないか確認してください。
```

### 8. スクリーンショットの取得

ビジュアル確認用にスクリーンショットを撮影：

```
現在のページのスクリーンショットを撮影してください。
```

## 使用可能な Playwright MCP ツール

| ツール | 説明 |
|--------|------|
| `browser_navigate` | URL に遷移 |
| `browser_snapshot` | ページのアクセシビリティスナップショット取得 |
| `browser_click` | 要素をクリック |
| `browser_type` | テキストを入力 |
| `browser_select_option` | ドロップダウンで選択 |
| `browser_hover` | 要素にホバー |
| `browser_press_key` | キーを押下 |
| `browser_resize` | ウィンドウサイズ変更 |
| `browser_take_screenshot` | スクリーンショット撮影 |
| `browser_console_messages` | コンソールメッセージ取得 |
| `browser_navigate_back` | 前のページに戻る |
| `browser_close` | ブラウザを閉じる |

## プロンプト例

### 基本的な探索テスト

```
Playwrightツールを使って、https://example.com/にアクセスしてください。
Webアプリの挙動を探索的にテストしてください。
```

### 特定ページのテスト

```
Playwrightを使って以下をテストしてください：
1. https://example.com/contact にアクセス
2. フォームに適当な値を入力
3. 送信ボタンの動作を確認
4. バリデーションエラーの表示を確認
```

### レスポンシブテスト

```
Playwrightで https://example.com/ のレスポンシブデザインをテストしてください。
- デスクトップ（1280x720）
- タブレット（768x1024）
- モバイル（375x812）
各サイズでスクリーンショットを撮影してください。
```

### パフォーマンス観点のテスト

```
Playwrightで https://example.com/ にアクセスし、以下を確認してください：
- ページの読み込み完了
- 画像の遅延読み込み動作
- コンソールエラーの有無
```

## テスト結果のレポート形式

テスト結果は以下の2部構成でまとめます：

### ドキュメント構成

```
reports/
└── YYYYMMDD_サイト名/
    ├── README.md              # テスト結果レポート
    └── screenshots/           # スクリーンショット
        ├── page_name.png
        └── responsive_xxx.png
```

### 1. テスト結果（README.md）

```markdown
# テスト結果: [サイト名]

## テスト概要

| 項目 | 内容 |
|------|------|
| テスト対象 | https://example.com/ |
| テスト日 | YYYY-MM-DD |
| テストツール | Playwright MCP |

## テスト結果サマリー

| テスト項目 | 結果 | 備考 |
|------------|------|------|
| ナビゲーション | ✅ PASS | |
| フォームバリデーション | ✅ PASS | |
| レスポンシブデザイン | ✅ PASS | |
| コンソールエラー | ✅ PASS | |

## 詳細テスト結果

### ページ別結果

| ページ | URL | 結果 |
|--------|-----|------|
| トップ | / | ✅ 正常 |
| 詳細 | /detail | ✅ 正常 |

### スクリーンショット

| ファイル名 | 説明 |
|-----------|------|
| `top_desktop.png` | トップページ（デスクトップ） |
| `top_mobile.png` | トップページ（モバイル） |
```

### 2. 修正が必要な箇所のレポート

テスト結果で問題が発見された場合、以下の形式で記載：

```markdown
## 修正が必要な箇所

### 問題なし の場合
**発見した問題: なし**

### 問題あり の場合

| # | 重要度 | ページ | 問題概要 |
|---|--------|--------|----------|
| 1 | 🔴 高 | /contact | フォーム送信エラー |
| 2 | 🟡 中 | /about | 画像読み込み遅延 |
| 3 | 🟢 低 | / | タイポ発見 |

### 問題詳細

#### 問題 #1: フォーム送信エラー

| 項目 | 内容 |
|------|------|
| 重要度 | 🔴 高 |
| 発生ページ | https://example.com/contact |
| 再現手順 | 1. /contactにアクセス<br>2. フォームに入力<br>3. 送信ボタンをクリック |
| 期待される動作 | 送信完了メッセージが表示される |
| 実際の動作 | 500エラーが発生 |
| スクリーンショット | `error_contact_form.png` |
| 推奨対応 | サーバーサイドのエラーハンドリングを確認 |
```

## スクリーンショットの保存

テスト完了後、スクリーンショットはテスト結果ディレクトリに移動してください：

```bash
# スクリーンショットの移動
mkdir -p tools/playwright-mcp/reports/YYYYMMDD_サイト名/screenshots
mv .playwright-mcp/*.png tools/playwright-mcp/reports/YYYYMMDD_サイト名/screenshots/
```

**重要**: `.playwright-mcp/` ディレクトリはPlaywrightのデフォルト出力先です。テスト完了後、必ずスクリーンショットを適切なレポートディレクトリに移動してください。

## 注意事項

1. **本番環境での注意**: フォーム送信テストは実際にデータを送信する可能性があるため、テスト環境で実施することを推奨

2. **認証が必要なページ**: ログインが必要なページはセッション管理に注意

3. **動的コンテンツ**: JavaScript で動的に生成されるコンテンツは、適切な待機時間を考慮

4. **外部サービス**: 埋め込みコンテンツ（YouTube、Vimeo など）は外部サービスに依存

## 関連リンク

- [Playwright 公式ドキュメント](https://playwright.dev/)
- [Playwright MCP Server](https://github.com/microsoft/playwright-mcp)
